<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:"Calibri Light";
	panose-1:2 15 3 2 2 2 4 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:0in;
	line-height:106%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
h1
	{mso-style-link:"Heading 1 Char";
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:106%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Calibri Light",sans-serif;
	color:#2E74B5;
	font-weight:normal;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:2.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:106%;
	page-break-after:avoid;
	font-size:13.0pt;
	font-family:"Calibri Light",sans-serif;
	color:#2E74B5;
	font-weight:normal;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"Header Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Footer Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Calibri Light",sans-serif;
	color:#2E74B5;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Calibri Light",sans-serif;
	color:#2E74B5;}
span.HeaderChar
	{mso-style-name:"Header Char";
	mso-style-link:Header;}
span.FooterChar
	{mso-style-name:"Footer Char";
	mso-style-link:Footer;}
.MsoChpDefault
	{font-size:10.0pt;
	font-family:"Calibri",sans-serif;}
 /* Page Definitions */
 @page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
-->
</style>

</head>

<body lang=EN-US>

<div class=WordSection1>

<p class=MsoNormal>&nbsp;</p>

<h1>Milestone 3 Goal</h1>

<p class=MsoNormal>Showcase the file sharing between remote EC2 Instance and
local laptop, which is done securely through VPN server configuration on server
and client.</p>

<h1>Solution</h1>

<h2>Configure EC2 Instance as VPN Server</h2>

<p class=MsoNormal>In EC2 Instance Ubuntu, create or update
/etc/wireguard/wg0.conf</p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=623 valign=top style='width:467.5pt;border:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'>[Interface]</p>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'>Address = 10.20.30.1</p>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'>ListenPort = 41820</p>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'>PrivateKey = &lt;SERVER PRIVATE KEY&gt;</p>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'>PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING
  -o eth0 -j MASQUERADE</p>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'>PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D
  POSTROUTING -o eth0 -j MASQUERADE</p>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'>&nbsp;</p>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'>[Peer]</p>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'># Name: windows-client</p>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'>PublicKey = &lt;CLIENT PUBLIC KEY&gt;</p>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'>AllowedIPs = 10.20.30.4/32</p>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'>&nbsp;</p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<h2>Configure Laptop as VPN client/peer</h2>

<p class=MsoNormal>In Windows laptop, create or update WireGuard Tunnel</p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=637 valign=top style='width:467.5pt;border:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'><img width=623 height=210
  src="M3%20Accessing%20AWS%20S3%20bucket%20through%20VPN%20connection_files/image001.jpg"></p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<h2>Apply bucket policy on S3 Bucket</h2>

<p class=MsoNormal>In the AWS Management Console, open the S3 bucket to be
secured with VPN connection.  Apply the Bucket Policy to deny access except for
VPN Server IP.</p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=637 valign=top style='width:467.5pt;border:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'><img width=623 height=543
  src="M3%20Accessing%20AWS%20S3%20bucket%20through%20VPN%20connection_files/image002.jpg"></p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<h2>Test accessing S3 bucket from laptop, without VPN connection</h2>

<p class=MsoNormal>In AWS Management Console, open Amazon S3 and the bucket
with limited policy (see earlier step), and I can’t see the S3 objects.</p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=638 valign=top style='width:467.5pt;border:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'><img width=624 height=323 id="Picture 1"
  src="M3%20Accessing%20AWS%20S3%20bucket%20through%20VPN%20connection_files/image003.jpg"></p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<h2>Test accessing S3 bucket from laptop, with VPN connection</h2>

<p class=MsoNormal>In the laptop VPN WireGuard, I first ensured the VPN tunnel
is active.</p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=637 valign=top style='width:467.5pt;border:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'><img width=623 height=210
  src="M3%20Accessing%20AWS%20S3%20bucket%20through%20VPN%20connection_files/image004.jpg"></p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>In AWS Management Console, open Amazon S3 and the bucket
with limited policy (see earlier step), and I see the S3 objects.</p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=638 valign=top style='width:467.5pt;border:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'><img width=624 height=319 id="Picture 2"
  src="M3%20Accessing%20AWS%20S3%20bucket%20through%20VPN%20connection_files/image005.jpg"></p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Also, I accessed the same bucket using AWS CLI S3 command.</p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=623 valign=top style='width:467.5pt;border:solid windowtext 1.0pt;
  padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'><img width=381 height=76 id="Picture 3"
  src="M3%20Accessing%20AWS%20S3%20bucket%20through%20VPN%20connection_files/image006.png"></p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<h1>Summary</h1>

<p class=MsoNormal>With the VPN connection between laptop and VPN server, I am
successfully able to access AWS S3 bucket that is limited to the specific IP
address of VPN server.</p>

<p class=MsoNormal>The AWS S3 Bucket Policy is used to limit S3 access only to
VPN server IP address.  With VPN connection from laptop, the browser or AWS CLI
command from laptop is accessing the AWS S3 bucket.</p>

<p class=MsoNormal>&nbsp;</p>

</div>

</body>

</html>
